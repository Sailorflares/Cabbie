
<div class="blog blog-category blog-archive container">
  <h2 class="page-title text-center">
    <!-- <i class="fa fa-archive"></i> --> Reviews for: <%= @driver.formatted_name %> 
  </h2>
  <div class="row">
    <div class="col-md-4">
      <div class="blog-list blog-category-list">
        <article class="post col-md-10 col-sm-12 col-xs-12 col-md-offset-1 col-sm-offset-0 col-xs-offset-0" id="info-box-no-padding">
          <div class="post-inner">
            <div class="content" id="driver-infoboxes">
              <div class="meta">
                <div class="post-entry">
                  <% if @driver.medallion_number.length == 4 %>
                    <h4>Medallion Number: <%= @driver.medallion_number %></h4><br>
                  <% else %>
                    <h4>License Number: <%= @driver.medallion_number %></h4><br>
                  <% end %>
                  <h4>Number of Reviews: <%= @driver.ride_reviews.size %></h4><br>
                  <h4>Average Rating:</h4>
                  <div class="star-ratings-css">
                    <div class="star-ratings-css-top" style="width: <%= @driver.star_percentage %>%"><span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                    <div class="star-ratings-css-bottom"><span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </div> <!-- this is the end of col-md-4 -->
    <div class="col-md-4">
      <div class="blog-list blog-category-list">
        <article class="post col-md-10 col-sm-12 col-xs-12 col-md-offset-1 col-sm-offset-0 col-xs-offset-0" id="info-box-no-padding">
          <div class="post-inner">
            <div class="content" id="driver-infoboxes">
              <div class="meta">
                <div class="post-entry">
                  <% if @driver.violations.size > 0 %>
                    <h4><%= @driver.formatted_name %>'s Traffic Violations:</h4><br>
                      <% @driver.violations.each do |viol| %>
                          <h5><%= viol.date %>: Charge <%= viol.charge %><br><%= viol.description %></h5>
                      <% end %>
                  <% else %>
                    <h4><%= @driver.formatted_name %>'s Traffic Violations: 0</h4><br>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </article>
      </div>
    </div>
    
    <% if current_user %>
      <div class="col-md-4">
         <%= form_for @ride_review, url: user_ride_reviews_path(@user) do |f| %>
            <p><%= f.text_area(:comments, :placeholder => "Review your driver", :class => "form-control", :rows => 10)%></p>
            <p><%= f.select :star_rating, options_for_select([1,2,3,4,5]), :autofocus => false%></p>
            <p>
            <%= f.label :uber do %>Uber driver?
              <%= f.check_box :uber %>
            <% end %>
            </p>  
            <%= f.hidden_field :driver_id, :value => @driver.id %>
            <%= f.submit 'Submit review!', :class => 'btn btn-primary' %>
        <% end %>
      </div>
    <% else %>
        <!-- <div class="col-md-4" style="margin: 50px;"> -->
          <a href="/login" button type="button" class="btn btn-primary btn-lg btn-block">Please log in to write a review</a></button>
        <!-- </div> -->
    <% end %>
  </div>
</div>

   

  
  <% if @driver.ride_reviews.size == 0 %>
    <div class="row">
      <div class="col-md-7">
        <div class="blog-list blog-category-list">
          <article class="post col-md-10 col-sm-12 col-xs-12 col-md-offset-1 col-sm-offset-0 col-xs-offset-0">
            <div class="post-inner">
              <div class="content">
                <div class="meta">
                  <div class="post-entry">
                    <p>
                      It looks like <%= @driver.formatted_name %> doesn't have any reviews yet. Good news: you get to be the first one to review this driver!
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </article>          
        </div>
      </div><!--//7-->    
    </div><!--//row-->
  <% else %>
    <div class="row">
      <div class="col-md-6">
    <% @driver.ride_reviews.reverse.each do |rev| %>
      <div class="row">

        <div class="col-md-2">
          <div class="blog-list blog-category-list no-background-color-or-border">
             <article class="post col-md-10 col-sm-12 col-xs-12 col-md-offset-1 col-sm-offset-0 col-xs-of fset-0">
              <div class="post-inner" id="no-background-color-or-border">
                <div class="content">
                  <div class="date-label">
                    <span class="month"><%= rev.created_at.localtime.strftime("%b") %></span>
                    <span class="date-number">
                      <%= rev.created_at.localtime.strftime("%d") %>
                    </span>
                  </div>
                </div>
              </div>
            </article>
          </div>
        </div>

        <div class="col-md-10" style="display: inline-block;">
          <div class="panel panel-primary">
            <div class="panel-heading">
              <h3 class="panel-title"><%= rev.created_at.localtime.strftime("%m/%d/%Y") %></h3>


              <div class="star-ratings-css">
                <div class="star-ratings-css-top" style="width: <%= rev.star_rating_percentage %>%"><span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
                <div class="star-ratings-css-bottom"><span>★</span><span>★</span><span>★</span><span>★</span><span>★</span></div>
              </div>
            </div>
            <div class="panel-body">
              <a href="<%= user_path(rev.user_id) %>"><%= rev.user.name %></a><br>
              <!-- <span class="glyphicon glyphicon-pencil"><p><%= pluralize(rev.user.ride_reviews.count, 'review') %></p></span> -->
              <br>
              <p><%= rev.comments %></p>
              <div class="voting-system" id="thumbs-up">
                <% if current_user %>  
                  <%= form_for @vote, url: user_ride_review_votes_path(@user.id, rev.id) do |f| %>
                    <%= f.hidden_field :value_of_votes, :value => "1" %>
                    <%= f.hidden_field :ride_review_id, :value => rev.id %>
                    <%= f.button '<i class="fa fa-thumbs-o-up"></i>'.html_safe %>
                    <!-- :class => "glyphicon glyphicon-thumbs-up" -->
                  <% end %>
                    <% if rev.votes  %>
                      <h5 style=><%= rev.votes.map { |vote| vote.value_of_votes }.inject(:+) %></h5>
                    <% end %>
                  <%= form_for @vote, url: user_ride_review_votes_path(@user.id, rev.id) do |f| %>
                    <%= f.hidden_field :value_of_votes, :value => "-1" %>
                    <%= f.hidden_field :ride_review_id, :value => rev.id %>
                    <%= f.button '<i class="fa fa-thumbs-o-down"></i>'.html_safe %>
                  <% end %>
                <% end %>  
              </div>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>
  <% end %>       

<!-- ---------------------------------------------------------------------------------------- -->

</div><!-- container -->